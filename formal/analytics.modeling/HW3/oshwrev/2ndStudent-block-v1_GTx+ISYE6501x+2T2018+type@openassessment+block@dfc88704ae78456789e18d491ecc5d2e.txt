###################      Question 7.1   ###########################################

library(timeSeries)
library(ggplot2)
install.packages("forecast")

#let's read the file in and call it "temp"
temp <- read.table("c:/users/kkisner/Desktop/gradclass/temps.txt", header = TRUE)
temp <- as.vector(unlist(temp[,2:21]))

#let's make the data a time series, and then check out what it gives us to be sure we're working properly.
tempts <- ts(temp, start = 1996, frequency = 123)
tempts
#great!  It starts in 1996 and ends is 2015... just what we wanted.

#let's see what the data looks like
plot(tempts)
#well, nothing is too obvious about the trends, but there's clearly seasonality.

#Let's do the exponential smoothing with Holt Winters.  I added that seasonality is multiplicative.
#I set beta = FALSE becuase the help said that would make it do exponential smoothing.
#In practice, I got the same answer regardless of not mentioning beta, beta = NULL, and beta = FALSE.
HW <- HoltWinters(tempts, beta = FALSE, seasonal = "mult")
HW
#This gives me alpha .6150, beta = 0, gamma = 0.5495

#Let's take a look at what the filtering looks like.
plot(HW)

#Let's decompose our model into the trend and seasonal to see what's happening
decomposeTemp <-decompose(tempts, type = "multiplicative", filter=NULL)
plot(decomposeTemp)

#Based on this, there is clear seasonality, but there is no clear trend.

#So what are our seasonality factors?  I'm going to put them in a matrix:
season <- matrix(HW$fitted[,3], nrow=123)
season
#Running CUSUM on the seasonality factors
model <- cusum(season, center = av_SF[1], std.dev = sd_SF[1], decision.interval = 2, se.shift =1, plot = TRUE)
#The R CUSUM model showed no significant changes.


#I then took this matrix and ran CUSUM in excel (attached separately) to see if I saw a change there
#Using the excel file, it seemed to confirm that there is no change in date for the end of summer.
#It was consistently 11 or 12 August.



###########################################   Question 8.2 ######################################################

crime <- read.table("c:/users/kkisner/Desktop/gradclass/uscrime.txt", header = TRUE)
head(crime)

#let's assign x and y to clean up the lm() formula below
y <- as.vector(crime$Crime)
x <- as.matrix(crime[,1:15])

#Now let's run the regression with the cleaned up x and y
model <-lm(y~x, data = crime)

#What does that give us?
summary(model)

#Let's see if linear regression was a good choice
plot(residuals(model))
#yep, the points look pretty randomly distributed... Seems like linear was a good fit.

#Let's check for heteroscedasticity, normality, and any influential observations
layout(matrix(c(1,2,3,4),2,2)) # optional 4 graphs/page 
plot(model)

#how well did our variables work?
anova(model)
#Great!  Look at that SUPER LOW value for F!

#We have a lot of variables... we might have multicollinearity
#So what does our pair-wise correlation look like?
library(GGally)
X<-crime[,1:15]
ggpairs(X)
# Looks like Po1 and Po2 may be related. 


