---
title: "HW6-ISYE6501x-Summer2018-OA"
author: "OA"
date: "6/23/2018"
output: pdf_document
---


### Objectives

In this week, the focus was on prescriptive analytics. We reviewed  some probability-based models and techniques, as well as optimization. We also covered some advanced data preparation â€“ what to do when data is missing. In this homework assignment we also learnt how to use simulation software.

```{r preRequisites, echo=FALSE, message=FALSE, warning=FALSE}
# installing packages if needed
if("ggplot2" %in% rownames(installed.packages()) == FALSE) {install.packages("ggplot2")}
#if("grid" %in% rownames(installed.packages()) == FALSE) {install.packages("grid")}
#if("gridExtra" %in% rownames(installed.packages()) == FALSE) {install.packages("gridExtra")}
#if("gtools" %in% rownames(installed.packages()) == FALSE) {install.packages("gtools")}
#if("reshape" %in% rownames(installed.packages()) == FALSE) {install.packages("reshape")}
if("purrr" %in% rownames(installed.packages()) == FALSE) {install.packages("purrr")}
if("kknn" %in% rownames(installed.packages()) == FALSE) {install.packages("kknn")}

# loading libraries
rm(list = ls())
library(ggplot2)
#library(grid)
#library(gridExtra)
#library(gtools)
#library(reshape)
library(purrr)
library(kknn)
```

####Question 13.2 simulation
(done in Arena, appended to this pdf at the end)

####Question 14.1
**The breast cancer data set breast-cancer-wisconsin.data.txt from http://archive.ics.uci.edu/ml/machine-learning-databases/breast-cancer-wisconsin/ (description at http://archive.ics.uci.edu/ml/datasets/Breast+Cancer+Wisconsin+%28Original%29 ) has missing values.**
**1. Use the mean/mode imputation method to impute values for the missing data. **
**2. Use regression to impute values for the missing data.**
**3. Use regression with perturbation to impute values for the missing data.**
**4. (Optional) Compare the results and quality of classification models (e.g., SVM, KNN) build using**
**(1) the data sets from questions 1,2,3;**
**(2) the data that remains after data points with missing values are removed; and (3) the data set when a binary variable is introduced to indicate missing values.**


```{r loadData-13.2, echo=TRUE, message=FALSE, warning=FALSE}

dataFile <- "breast.cancer.data.txt"
if (!file.exists(dataFile)) {
  #crimeDataURL <- paste0(c("http://www.statsci.org/data/general/uscrime.txt"))
  bcURL <- paste0(c("http://archive.ics.uci.edu/ml/machine-learning-databases/breast-cancer-wisconsin/breast-cancer-wisconsin.data"))
  
  download.file(bcURL, dataFile) }

breastCancerTable <- read.csv(dataFile, header = FALSE, na.strings = "\\?" )

```

From the website, the details for each column are :
Attribute Information:

1. Sample code number: id number 
2. Clump Thickness: 1 - 10 
3. Uniformity of Cell Size: 1 - 10 
4. Uniformity of Cell Shape: 1 - 10 
5. Marginal Adhesion: 1 - 10 
6. Single Epithelial Cell Size: 1 - 10 
7. Bare Nuclei: 1 - 10 
8. Bland Chromatin: 1 - 10 
9. Normal Nucleoli: 1 - 10 
10. Mitoses: 1 - 10 
11. Class: (2 for benign, 4 for malignant)


- the above legend helps out craft our game plan:
  - *we will do mean() for all values and round them up*
  - *we will do mode() for the categorical column 11*
  - *we will ofcourse skip column 1, its just a code number*
  
- Let's name each column appropriately,
- as well asl sample a little data to see where we do mean and where we apply mode:

```{r nameCols-13.1, echo=TRUE, message=FALSE, warning=FALSE}
colnames(breastCancerTable) <- c("sampleCodeNumber",
                                 "clumpThickness",
                                 "cellSizeUniformity",
                                 "cellShapeUniformity",
                                 "marginalAdhesion",
                                 "singleEpithelialCellSize",
                                 "bareNuclei",
                                 "blandChromatin",
                                 "normalNucleoli",
                                 "Mitoses",
                                 "Class")

  head(breastCancerTable, 3)
```


####1. Use the mean/mode imputation method to impute values for the missing data.*

```{r fillingMeanModeInMissing-13.1, echo=TRUE, message=FALSE, warning=FALSE}
getMode <- function(v) {
   uniqv <- unique(v)
   uniqv[which.max(tabulate(match(v, uniqv)))]
}

breastCancerTable[which(breastCancerTable$bareNuclei == "?"),]

errors <- breastCancerTable[which(breastCancerTable$bareNuclei == "?"), ]
percentNoData <- length(errors)/length(breastCancerTable$bareNuclei)

#storing the indices of missing data:
missingDataIndices <- which(breastCancerTable$bareNuclei == "?", arr.ind = TRUE)

#find mode of clean data:
mode_bareNuclei <- as.numeric(getMode(breastCancerTable[-missingDataIndices, "bareNuclei"]))
#find mean:
mean_bareNuclei <- round(mean(as.numeric(breastCancerTable[-missingDataIndices, "bareNuclei"])))

mean_bareNuclei

#gsub("\\?","22",breastCancerTable[322,])
#breastCancerTable[322,]

```

- by using vector manipulation , we identified the missing data, and specifically the column with the missing data (bareNuclei)
- only 1.5% is supected data, which is less than the 5% watermark, and thus should allowed to do imputations.
- we simple now create a copy of the breastCancerTable and impute all the values with the mean. **i chose not to use the mode, since this cellNuclei is not a categorical variable, its just a value between a range.

```{r fillingMeanModeInMissing-13.1b, echo=TRUE, message=FALSE, warning=FALSE}
breastCancerTableImputedByMean <- breastCancerTable
breastCancerTableImputedByMean[missingDataIndices, ]$bareNuclei <- as.integer(mean_bareNuclei)

```

- let's see how the original and the current missing data compares:

- first we print the first 3 lines of the observations which have missing data. Note the "?" in bareNuclei column
```{r compareCurrentWithImputedMean-13.1c, echo=TRUE, message=FALSE, warning=FALSE}
head(breastCancerTable[which(breastCancerTable$bareNuclei == "?"), ], 3)

```

- now let's print the same lines from the new data table with imputed values:
```{r compareCurrentWithImputedMean-13.1, echo=TRUE, message=FALSE, warning=FALSE}
#head(breastCancerTable[which(breastCancerTable$bareNuclei == "?"), ], 3)
breastCancerTableImputedByMean[24,]
breastCancerTableImputedByMean[41,]
breastCancerTableImputedByMean[140,]

```

*Summary: the verification above confirms that the imputation has worked effectively and the missing data is "no more!"*





####2. Us24e regression to impute values for the missing data.

- do the same stuff as in step 1..
- first pulling out everything but the missing data and just the predictors (i.e ignoring the id (column1), and the response (class, column 11))
- and using those predictors to identify the values for the missing data using regression (this is a pretty cool way of doing it and more realistic instead of applying the flat mean or mode, the only issue is its more complicated as now we have to manage a regression model for the missing values and a regression value of the actual prediction!)
```{r regressionImputation-13.1a, echo=TRUE, message=FALSE, warning=FALSE}
bcPredictors <- breastCancerTable[-missingDataIndices, 2:10]
# converting to integer so the lm can write back into this column without error
bcPredictors$bareNuclei <- as.integer(bcPredictors$bareNuclei)

# running the linear regression, to predict the bareNuclei  values (note its predicting ALL the values , including non missing ones, so we'll have to pick out the indices of the observations with the missing ones out of this )
bareNucleiLRM <- lm(bareNuclei~., data = bcPredictors)
summary(bareNucleiLRM)
```

- clearly the more is pretty bad, looking at the r-squared value, so let's just pick up the specific predictors which have low p-value, which are:
  - clumpThickness            0.068118   0.034746   1.960  0.05035 .  
  - cellShapeUniformity       0.110046   0.061190   1.798  0.07255 .  
  - marginalAdhesion         -0.076950   0.038270  -2.011  0.04475 *  
  - normalNucleoli            0.119422   0.037076   3.221  0.00134 ** 
  
- and re-run the regression with just these:

  
```{r regressionImputation-13.1b, echo=TRUE, message=FALSE, warning=FALSE}
bareNucleiLRM <- lm(bareNuclei ~ clumpThickness + cellShapeUniformity + marginalAdhesion + normalNucleoli, data = bcPredictors)
summary(bareNucleiLRM)
```

- hmm, the model has gone from bad to worse, perhaps this is the way it is. the data in this model is just insufficient in accurately predicting the missing Values.
- **MOVING ON!!**
- getting the predicted values for the missing bareNuclei from the last model..
- though the TA recommended this in her notes, i did not run k-fold test as I couldn't figure out how cv.kknn, or train.kknn which are classification models apply to linear regression.

```{r regressionImputation-13.1c, echo=TRUE, message=FALSE, warning=FALSE}
bareNucleiPredicted <- predict(bareNucleiLRM, newdata = breastCancerTable[missingDataIndices, ])
breastCancerTableImputedByRegression <- breastCancerTable
breastCancerTableImputedByRegression[missingDataIndices, ]$bareNuclei <- round(bareNucleiPredicted)
breastCancerTableImputedByRegression$bareNuclei <- as.integer(breastCancerTableImputedByRegression$bareNuclei)
breastCancerTableImputedByRegression[missingDataIndices, ]$bareNuclei
```


- looks like a clean set of new bareNuclei data that would be inserted into the missing data slots.
- lets ensure we limit the range of the data from 1-10 which is the prescribed limit for bareNuclei

```{r regressionImputation-13.1d, echo=TRUE, message=FALSE, warning=FALSE}
#make sure no bareNuclei values are outside of original range:
breastCancerTableImputedByRegression$bareNuclei[breastCancerTableImputedByRegression$bareNuclei > 10 ] <-10
breastCancerTableImputedByRegression$bareNuclei[breastCancerTableImputedByRegression$bareNuclei < 1 ] <-1


```

that's it , we're done!

**3. Use regression with perturbation to impute values for the missing data.**

- this model is nothing more than adding a little error into the regression values created for the missing data..
- the raw values perturbed (unrounded values are printed here: )
```{r regressionImputation-13.1.3a, echo=TRUE, message=FALSE, warning=FALSE}
# first, creating a normal distribution
bareNucleiPerturbed <- rnorm(nrow(breastCancerTable[missingDataIndices,]), bareNucleiPredicted, sd(bareNucleiPredicted))

bareNucleiPerturbed
```


```{r regressionImputation-13.1.3b, echo=TRUE, message=FALSE, warning=FALSE}
breastCancerTablePerturbed <- breastCancerTable
breastCancerTablePerturbed[missingDataIndices, ]$bareNuclei <- round(bareNucleiPerturbed)
breastCancerTablePerturbed$bareNuclei <- as.integer(breastCancerTablePerturbed$bareNuclei)

# round to integers


breastCancerTablePerturbed$bareNuclei[breastCancerTablePerturbed$bareNuclei > 10] <- 10
breastCancerTablePerturbed$bareNuclei[breastCancerTablePerturbed$bareNuclei < 1] <- 1

```

- 
```{r compareCurrentWithImputedPerturbed-a, echo=TRUE, message=FALSE, warning=FALSE}
head(breastCancerTable[which(breastCancerTable$bareNuclei == "?"), ], 3)

```

- now let's print the same lines from the new data table with imputed mean values:
```{r compareCurrentWithImputedPerturbed-b, echo=TRUE, message=FALSE, warning=FALSE}
#head(breastCancerTable[which(breastCancerTable$bareNuclei == "?"), ], 3)
breastCancerTableImputedByMean[24,]
breastCancerTableImputedByMean[41,]
breastCancerTableImputedByMean[140,]

```

- finally let's printed the same observations with perturbed bareNuclei values:
```{r compareCurrentWithImputedPerturbed-c, echo=TRUE, message=FALSE, warning=FALSE}
#head(breastCancerTable[which(breastCancerTable$bareNuclei == "?"), ], 3)
breastCancerTablePerturbed[24,]
breastCancerTablePerturbed[41,]
breastCancerTablePerturbed[140,]

```

** Summary we can clearly see a lot more variety in even the 3 imputed (perturbed) values above than the earlier imputation methods.


#### Question 15.1
**Describe a situation or problem from your job, everyday life, current events, etc., for which optimization would be appropriate. What data would you need?**


Optimization can be used for prescriptive analytics. I would use it to select which college my son can choose to go to based on financial, qualititative, and location preferences. information I'd need would be  information on each school's costs for the program my son selects, information on the rankings and ratings from industry, internally and cross-peer (typically published by US news ) and distance door to doo from our house to that school.
